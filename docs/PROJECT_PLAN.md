# 離線登山導航 App - 專案規劃

## 專案概述

**專案名稱**: EzMap - 簡易登山導航

**目標**: 建立一個簡單易用的離線地圖 Flutter App，專為登山愛好者設計，提供 GPS 軌跡記錄、導航和數據分析功能。

**核心特色**:
- 📍 完全離線運作
- 🗺️ 離線地圖支援
- 📊 即時數據顯示
- 🧭 精準導航輔助
- 📈 活動數據分析

---

## 功能模組規劃

### 模組一：地圖系統 🗺️

#### 1.1 離線地圖
- **功能描述**: 顯示可離線使用的地形圖
- **技術方案**: 
  - 使用 `flutter_map` 套件
  - 離線地圖磁磚快取 (MBTiles 格式)
  - 支援多種地圖圖層（地形圖、等高線圖）
- **優先級**: P0 (最高)

#### 1.2 地圖互動
- 縮放、平移
- 定位當前位置
- 地圖旋轉（依指南針方向）
- **優先級**: P0

#### 1.3 路線顯示
- 即時軌跡繪製（紅色/藍色線條）
- 參考路線顯示（不同顏色，如綠色/黃色）
- 雙路線對比模式
- **優先級**: P0

---

### 模組二：GPX 軌跡記錄 📝

#### 2.1 軌跡錄製控制
- **功能按鈕**:
  - 🟢 **開始記錄**: 開始 GPS 定位並記錄軌跡
  - ⏸️ **暫停記錄**: 暫停記錄（不計入移動時間）
  - ⏹️ **結束記錄**: 結束並儲存 GPX 檔案
  - ▶️ **繼續記錄**: 從暫停狀態恢復
- **技術方案**: 
  - 使用 `geolocator` 套件獲取 GPS 位置
  - 使用 `gpx` 套件處理 GPX 格式
  - 背景定位服務 (`background_location` 或 `workmanager`)
- **優先級**: P0

#### 2.2 軌跡儲存與管理
- 自動儲存 GPX 檔案（命名：日期時間）
- 本地儲存管理
- 匯出 GPX 到外部儲存
- **優先級**: P0

#### 2.3 GPX 匯入
- 匯入參考路線 GPX
- 多條路線管理
- 路線預覽
- **優先級**: P1

---

### 模組三：即時數據顯示 📊

#### 3.1 主要儀表板
顯示以下即時資訊：

| 項目 | 說明 | 單位 |
|------|------|------|
| **當前高度** | GPS 高度（氣壓計校正） | 公尺 |
| **即時速度** | 移動速度 | km/h |
| **累積距離** | 總移動距離 | 公里 |
| **累積上升** | 總爬升高度 | 公尺 |
| **累積下降** | 總下降高度 | 公尺 |
| **平均速度** | 移動時平均速度 | km/h |
| **移動時間** | 實際移動時間（扣除暫停） | hh:mm:ss |
| **經過時間** | 總時間（含暫停） | hh:mm:ss |
| **當前座標** | 經緯度 | 度 |

- **UI 設計**: 卡片式佈局，清晰易讀
- **優先級**: P0

#### 3.2 座標資訊與複製
- 顯示當前經緯度（度分秒 / 十進位）
- 一鍵複製座標功能
- 格式選擇（多種座標格式）
- **優先級**: P1

#### 3.3 日出日落時間
- **計算方式**: 
  - 使用 `sunrise_sunset` 套件或 API
  - 根據當前經緯度和日期計算
  - 離線演算法（SPA 演算法）
- 顯示當日日出/日落時間
- 剩餘日照時間提醒
- **優先級**: P2

---

### 模組四：圖表與數據分析 📈

#### 4.1 高度圖表
- X 軸：距離或時間
- Y 軸：高度
- 即時更新
- **技術方案**: 使用 `fl_chart` 套件
- **優先級**: P1

#### 4.2 速度圖表
- 顯示速度變化曲線
- 標示最快/最慢速度點
- **優先級**: P2

#### 4.3 活動分析報告
- **包含內容**:
  - 路線統計摘要
  - 高度剖面圖
  - 速度分布圖
  - 停留時間分析
  - 里程碑標記
- 可匯出分析報告（PDF/圖片）
- **優先級**: P2

---

### 模組五：指南針與導航 🧭

#### 5.1 數位指南針
- 顯示方位角度（0-360°）
- 標示主要方位（N/S/E/W）
- 即時旋轉動畫
- **技術方案**: 使用 `flutter_compass` 套件
- **優先級**: P1

#### 5.2 距離測量工具
- **點擊地圖設置目標點**
- 計算直線距離
- 顯示方位角
- 支援多點測量
- **優先級**: P1

---

### 模組六：記錄點管理 📍

#### 6.1 記錄點 (Waypoint) 功能
- **新增記錄點**:
  - 手動標記當前位置
  - 自動命名（時間戳或序號）
  - 自訂名稱與備註
  - 選擇圖示/顏色
- **記錄點列表**:
  - 顯示所有記錄點
  - 座標、時間、高度資訊
  - 照片附加（選配）
- **導航到記錄點**:
  - 計算距離與方向
  - 地圖上顯示
- **優先級**: P1

#### 6.2 記錄點匯入/匯出
- 支援 GPX waypoint 格式
- 批次管理
- **優先級**: P2

---

## 技術架構

### 核心技術棧

```
Flutter SDK: >= 3.0.0
Dart: >= 3.0.0
```

### 主要套件依賴

| 套件名稱 | 用途 | 版本 |
|---------|------|------|
| `flutter_map` | 地圖顯示 | ^6.0.0 |
| `latlong2` | 經緯度計算 | ^0.9.0 |
| `geolocator` | GPS 定位 | ^10.0.0 |
| `permission_handler` | 權限管理 | ^11.0.0 |
| `gpx` | GPX 檔案處理 | ^2.2.0 |
| `path_provider` | 檔案路徑 | ^2.1.0 |
| `sqflite` | 本地資料庫 | ^2.3.0 |
| `flutter_compass` | 指南針 | ^0.8.0 |
| `fl_chart` | 圖表繪製 | ^0.66.0 |
| `intl` | 國際化與日期格式 | ^0.19.0 |
| `share_plus` | 分享功能 | ^7.2.0 |

### 資料儲存方案

#### 1. 本地資料庫 (SQLite)
- 活動記錄
- 記錄點資料
- 設定檔

#### 2. 檔案系統
- GPX 檔案儲存
- 離線地圖磁磚
- 快取資料

#### 3. 資料結構設計

```dart
// 活動記錄
class Activity {
  String id;
  String name;
  DateTime startTime;
  DateTime? endTime;
  double totalDistance;
  double totalAscent;
  double totalDescent;
  double maxSpeed;
  double avgSpeed;
  Duration movingTime;
  Duration totalTime;
  String gpxFilePath;
}

// GPS 點位
class TrackPoint {
  double latitude;
  double longitude;
  double? altitude;
  DateTime timestamp;
  double? speed;
}

// 記錄點
class Waypoint {
  String id;
  String name;
  String? description;
  double latitude;
  double longitude;
  double? altitude;
  DateTime timestamp;
  String? icon;
}
```

---

## UI/UX 設計方案

### 主要頁面架構

```
App 結構
├── 首頁 (地圖頁)
│   ├── 地圖顯示區域 (全螢幕)
│   ├── 浮動控制按鈕
│   │   ├── 定位按鈕
│   │   ├── 圖層切換
│   │   └── 指南針
│   ├── 底部數據面板 (可收合)
│   │   └── 即時數據儀表板
│   └── 錄製控制列
│       └── 開始/暫停/結束按鈕
│
├── 活動列表頁
│   ├── 歷史記錄列表
│   ├── 篩選與搜尋
│   └── 統計摘要
│
├── 活動詳情頁
│   ├── 路線地圖
│   ├── 數據統計
│   ├── 高度圖表
│   └── 記錄點列表
│
├── 記錄點頁面
│   ├── 記錄點列表
│   └── 記錄點詳情
│
└── 設定頁
    ├── 地圖設定
    ├── GPS 設定
    ├── 單位設定
    └── 匯入/匯出
```

### 顏色方案

```
主題色：
- 主要色：#2E7D32 (登山綠)
- 次要色：#1976D2 (天空藍)
- 強調色：#F57C00 (日落橙)

路線顏色：
- 當前軌跡：#E53935 (紅色)
- 參考路線：#FDD835 (黃色)
- 已完成路線：#43A047 (綠色)

狀態顏色：
- 記錄中：#FF5722 (深橙)
- 暫停：#FFC107 (琥珀)
- 完成：#4CAF50 (綠色)
```

### 重要 UI 考量

1. **單手操作**: 重要按鈕置於拇指可及範圍
2. **戶外可讀性**: 高對比度設計，支援日間/夜間模式
3. **省電模式**: 可調整 GPS 更新頻率
4. **防誤觸**: 重要操作需二次確認

---

## 開發階段規劃

### Phase 1: 核心功能 (MVP) - 預計 3-4 週

**目標**: 建立可用的基本導航功能

- [ ] 專案初始化與架構設計
- [ ] 離線地圖整合與顯示
- [ ] GPS 定位與權限管理
- [ ] GPX 軌跡記錄（開始/暫停/結束）
- [ ] 即時數據顯示（基本儀表板）
- [ ] 本地儲存（SQLite + 檔案系統）
- [ ] 活動列表與基本管理

**交付成果**: 
- 可記錄 GPS 軌跡的離線地圖 App
- 基本數據顯示與儲存功能

---

### Phase 2: 進階功能 - 預計 2-3 週

**目標**: 增強導航與分析能力

- [ ] 指南針整合
- [ ] 距離測量工具
- [ ] 記錄點管理
- [ ] GPX 匯入功能
- [ ] 高度圖表
- [ ] 座標複製功能
- [ ] 多路線顏色區分

**交付成果**:
- 完整的導航輔助工具
- 路線比對功能

---

### Phase 3: 數據分析與優化 - 預計 2 週

**目標**: 提供深度數據分析

- [ ] 活動分析報告
- [ ] 速度圖表
- [ ] 日出日落計算
- [ ] 匯出功能（GPX/PDF）
- [ ] UI/UX 優化
- [ ] 效能優化（電池、記憶體）

**交付成果**:
- 完整的活動分析系統
- 優化的使用體驗

---

### Phase 4: 測試與發布 - 預計 1-2 週

- [ ] 完整功能測試
- [ ] 實地登山測試
- [ ] Bug 修復
- [ ] 使用說明文件
- [ ] App Store / Google Play 上架準備

---

## 離線地圖方案

### 選項一：OpenStreetMap (建議)
- **優點**: 免費、開源、社群活躍
- **來源**: 
  - OpenTopoMap (地形圖)
  - Thunderforest Landscape
- **下載工具**: MOBAC (Mobile Atlas Creator)
- **格式**: MBTiles

### 選項二：自製地圖
- 使用政府開放資料（如台灣通用版電子地圖）
- 轉換為磁磚格式

### 儲存策略
- 預載特定區域地圖（例如：台灣山區）
- 縮放等級：10-16（平衡細節與檔案大小）
- 預估大小：單一山區約 100-500 MB

---

## 技術挑戰與解決方案

### 挑戰 1: GPS 精度問題
**解決方案**:
- 使用 Kalman 濾波平滑軌跡
- 結合氣壓計改善高度精度
- 允許手動校正

### 挑戰 2: 電池續航
**解決方案**:
- 可調整 GPS 取樣頻率（1-10 秒）
- 背景模式優化
- 省電模式（降低螢幕亮度、減少更新頻率）

### 挑戰 3: 離線地圖大小
**解決方案**:
- 僅預載常用區域
- 支援自訂下載區域
- 使用高效壓縮格式

### 挑戰 4: 背景執行限制 (iOS/Android)
**解決方案**:
- 使用前景服務 (Foreground Service)
- 顯示持續通知
- 申請背景定位權限

---

## 測試計劃

### 功能測試
- [ ] GPS 記錄準確性
- [ ] 離線地圖載入
- [ ] GPX 匯入/匯出
- [ ] 記錄點管理
- [ ] 數據計算正確性

### 效能測試
- [ ] 長時間記錄（8+ 小時）
- [ ] 電池消耗測試
- [ ] 記憶體使用監控
- [ ] 大檔案處理 (10000+ 軌跡點)

### 實地測試
- [ ] 實際登山環境測試
- [ ] 不同天氣條件
- [ ] 訊號弱/無訊號環境
- [ ] 極端溫度測試

---

## 發布策略

### 版本規劃

**v1.0.0 - MVP 版本**
- 核心導航功能
- 基本數據記錄

**v1.1.0**
- 進階導航工具
- 記錄點功能

**v1.2.0**
- 數據分析報告
- 圖表功能

**v2.0.0**
- 社群分享功能
- 路線推薦系統

### 平台發布

1. **Beta 測試**: TestFlight (iOS) + Google Play Beta
2. **正式發布**: App Store + Google Play
3. **網站支援**: 提供使用教學與 FAQ

---

## 資源需求

### 開發資源
- Flutter 開發者 x 1
- UI/UX 設計師 x 1 (選配)
- 測試人員 x 1-2

### 硬體需求
- 測試裝置：iOS (1部) + Android (2部，不同品牌)
- 行動電源與防水保護殼

### 軟體工具
- Android Studio / VS Code
- Git 版本控制
- Figma (UI 設計)
- MOBAC (地圖下載)

---

## 未來擴充功能 (Roadmap)

### 短期 (3-6 個月)
- 🌐 多語言支援（中文/英文）
- 📷 照片與記錄點整合
- 🔋 更精細的省電模式
- 🎨 自訂主題顏色

### 中期 (6-12 個月)
- ☁️ 雲端備份（選擇性）
- 👥 社群路線分享
- 🏔️ 山岳資料庫整合
- ⚠️ 天氣警報整合

### 長期 (12+ 個月)
- 🤖 AI 路線推薦
- 🏃 多運動模式（健行/跑步/騎行）
- 📱 Wear OS / Apple Watch 支援
- 🗺️ 3D 地形顯示

---

## 總結

這個專案旨在創建一個**簡單、實用、可靠**的離線登山導航 App。核心優勢在於：

✅ **完全離線**: 無需網路連接即可使用  
✅ **簡潔介面**: 專注於核心功能，避免複雜操作  
✅ **精準記錄**: 詳細的 GPS 軌跡與數據分析  
✅ **開源友善**: 使用開源地圖與工具，降低成本  

預計總開發時間：**8-11 週**  
MVP 上線時間：**4 週**

---

**文件版本**: v1.0  
**最後更新**: 2025-11-06  
**專案狀態**: 規劃階段

